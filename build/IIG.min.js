var IIG=IIG||{};IIG.ImageManager=function(){this._filenames=[],this._sprites=[],this._spritesInstances=[],this._nbImagesLoaded=0,this._callback=function(){},this.imagesLoaded=!1},IIG.ImageManager.prototype={constructor:IIG.ImageManager,add:function(t,i){return this._filenames.push({label:t,path:i}),this},getInstance:function(t){var i=this._sprites[t],n=new IIG.Image({data:i.data,width:i.width,height:i.height,animation:i.animation});return this._spritesInstances.push(n),n},killInstance:function(t){for(var i=0,n=this._spritesInstances.length;n>i;i++)this._spritesInstances[i]===t&&(this._spritesInstances[i].isDestroyed=!0,this._spritesInstances[i].animation&&delete this._spritesInstances[i].animation,this._spritesInstances.splice(i,1),n--);if(t instanceof IIG.Image){var s=[t];s.splice(0,1),t=s=void 0}},loadAll:function(t){"function"==typeof t&&(this._callback=t);for(var i=this,n=0,s=this._filenames.length;s>n;n++){var a=this._filenames[n],e=new Image;e.onload=function(){i.loaded(this)},e.src=a.path,e.setAttribute("data-label",a.label),this._sprites[a.label]={data:e,width:0,height:0,animation:null}}},loaded:function(t){var i=t.getAttribute("data-label");this._sprites[i].width=t.width,this._sprites[i].height=t.height,++this._nbImagesLoaded===IIG.Utils.count(this._sprites)&&(this.imagesLoaded=!0,this._callback())},update:function(){for(var t,i,n,s,a=!1,e=0,o=this._spritesInstances.length;o>e;e++)!this._spritesInstances[e]instanceof IIG.Image||(t=this._spritesInstances[e],t.animation instanceof IIG.Animation&&!t.animation.pauseAnimation&&!t.pauseAnimation&&(t.animationDestroyed&&(t.animationDestroyed=!1),i=t.animation,++i.frameCount,i.frameCount<60/i.fps||(i.frameCount=0,i._resetAtNextState&&(a=!0,i._resetAtNextState=!1),"ltr"===i.animDirection||"rtl"===i.animDirection?(n=i.startPoint||0,s=i.endPoint||t.width,i.sx+=i.sWidth*i._animDirectionMultiplier,i.alternate?(i.sx<=n||i.sx+i.sWidth>=s)&&(i._animDirectionMultiplier*=-1,i._resetAtNextState=!0):"ltr"===i.animDirection?i.sx>=s&&(i.sx=n,a=!0):"rtl"===i.animDirection&&i.sx<n&&(i.sx=s-i.sWidth,a=!0)):("ttb"===i.animDirection||"btt"===i.animDirection)&&(n=i.startPoint||0,s=i.endPoint||t.height,i.sy+=i.sHeight*i._animDirectionMultiplier,i.alternate?(i.sy<=n||i.sy+i.sHeight>=s)&&(i._animDirectionMultiplier*=-1,i._resetAtNextState=!0):"ttb"===i.animDirection?i.sy>=s&&(i.sy=n,a=!0):"btt"===i.animDirection&&i.sy<n&&(i.sy=s-i.sHeight,a=!0)),a&&("number"==typeof i.iterations&&++i._iterationsCount>=i.iterations&&(this._spritesInstances[e].animation=i=void 0,this._spritesInstances[e].animationDestroyed=!0),a=!1))))},drawImage:function(t,i,n,s){return i.animation instanceof IIG.Animation?void t.drawImage(i.data,i.animation.sx,i.animation.sy,i.animation.sWidth,i.animation.sHeight,n,s,i.animation.sWidth,i.animation.sHeight):t.drawImage(i.data,n,s)}},IIG.Animation=function(t){this.frameCount=0,this.sx=0,this.sy=0,this.sWidth=0,this.sHeight=0,this.animDirection="ltr",this._animDirectionMultiplier=1,this.alternate=!1,this.fps=5,this.pauseAnimation=!1,this.iterations="infinite",this._iterationsCount=0,this._resetAtNextState=!1,this.startPoint=0,this.endPoint=0,"object"==typeof t&&(this.sx=parseInt(t.sx,10)>0?t.sx:this.sx,this.sy=parseInt(t.sy,10)>0?t.sy:this.sy,this.sWidth=parseInt(t.sWidth,10)>0?t.sWidth:this.sWidth,this.sHeight=parseInt(t.sHeight,10)>0?t.sHeight:this.sHeight,t.animDirection&&(("right2left"===t.animDirection||"left2right"===t.animDirection||"top2bottom"===t.animDirection||"bottom2top"===t.animDirection)&&console.warn("`ImageInGame` - Value '"+t.animDirection+"' is deprecated. Use instead 'rtl', 'ltr', 'ttb' or 'btt'"),t.animDirection="right2left"===t.animDirection?"rtl":t.animDirection,t.animDirection="left2right"===t.animDirection?"ltr":t.animDirection,t.animDirection="top2bottom"===t.animDirection?"ttb":t.animDirection,t.animDirection="bottom2top"===t.animDirection?"btt":t.animDirection,("rtl"===t.animDirection||"ltr"===t.animDirection||"ttb"===t.animDirection||"btt"===t.animDirection)&&(this.animDirection=t.animDirection),this._animDirectionMultiplier="rtl"===t.animDirection||"btt"===t.animDirection?-1:1),this.alternate=t.alternate||this.alternate,this.fps=parseInt(t.fps,10)>0?t.fps:this.fps,this.pauseAnimation=t.pauseAnimation||this.pauseAnimation,this.iterations=t.iterations||this.iterations,this.startPoint=t.startPoint||0,this.endPoint=t.endPoint||0,this.startPoint>0&&("ltr"===this.animDirection||"rtl"===this.animDirection?this.sx=this.startPoint:("ttb"===this.animDirection||"btt"===this.animDirection)&&(this.sy=this.startPoint)))},IIG.Image=function(t){"object"==typeof t&&(this.data=t.data,this.width=t.width,this.height=t.height,this.animation=t.animation,this.pauseAnimation=t.animation instanceof IIG.Animation?t.animation.pauseAnimation:!1,this.animationDestroyed=!1)},IIG.Utils={count:function(t){var i,n=0;for(i in t)t.hasOwnProperty(i)&&n++;return n}};